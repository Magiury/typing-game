<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>MorseType</title>

<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#323437;
  --fg:#d1d0c5;
  --sub:#646669;
  --accent:#a970ff;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:var(--bg);
  color:var(--fg);
  font-family:'JetBrains Mono', monospace;
  display:flex;
  justify-content:center;
  min-height:100vh;
}

#app{
  width:100%;
  max-width:1200px;
  padding:30px 40px;
}

#header{margin-bottom:40px}

#logo{font-size:22px;font-weight:600}
#logo span{color:var(--accent)}

#modes{
  display:flex;
  justify-content:center;
  gap:22px;
  margin-bottom:60px;
  color:var(--sub);
}

.mode{cursor:pointer}
.mode.active{color:var(--accent)}

#game{text-align:center}

#morse{
  font-size:26px;
  margin-bottom:20px;
  letter-spacing:3px;
  min-height:32px; /* üëà TH√äM D√íNG N√ÄY */
}


#text{
  font-size:32px;
  min-height:50px;
}

#decodeInput{
  margin-top:8px;          /* g·∫ßn morse h∆°n */
  padding:10px 16px;
  font-size:18px;
  background:#2a2b2d;
  border:2px solid #2a2b2d;
  border-radius:14px;      /* üëà bo tr√≤n */
  color:var(--fg);
  outline:none;
  width:420px;
  text-align:center;
}

#decodeInput:focus{
  border-color:var(--accent); /* vi·ªÅn t√≠m khi g√µ */
}


#result{
  margin-top:50px;
  display:none;
  gap:40px;
  justify-content:center;
  color:var(--sub);
}

.result-big{
  font-size:42px;
  color:var(--accent);
}

#header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:50px;
}

#modeBarWrap{
  display:flex;
  justify-content:center;
  width:100%;          /* üëà D√íNG QUAN TR·ªåNG */
  margin-bottom:60px;
}

#header-actions{
  display:flex;
  gap:20px;
  font-size:18px;
  color:var(--sub);
}

.hicon{
  cursor:pointer;
  transition:.15s;
  user-select:none;
}

.hicon:hover{
  color:var(--fg);
  transform:translateY(-1px);
}

#modeBar{
  display:inline-flex;              /* üëà QUAN TR·ªåNG */
  align-items:center;
  gap:18px;

  background:#2a2b2d;
  border-radius:14px;
  padding:12px 18px;
  margin:0;              /* üëà cƒÉn gi·ªØa */

  color:var(--sub);
  font-size:14px;
}

.bar-section{
  display:flex;
  align-items:center;
  gap:14px;
}

.bar-divider{
  width:2px;
  height:22px;
  background:#3a3b3d;
  border-radius:2px;
}

.bar-btn,
.mode,
.time{
  cursor:pointer;
  user-select:none;
  transition:.15s;
}

.bar-btn.active{
  color:#7ad07a;          /* xanh l√° */
}

.bar-btn:hover,
.mode:hover,
.time:hover{
  color:var(--fg);
}

.mode.active,
.time.active{
  color:inherit;
}
.time.active.rainbow{}

.mode.disabled{
  opacity:.4;
  cursor:default;
}

#infoPanel{
  position:fixed;
  top:80px;
  right:40px;
  width:420px;
  height:360px;

  background:#2a2b2d;
  border:2px solid #3a3b3d;
  border-radius:16px;

  display:none;
  flex-direction:column;

  resize:both;
  overflow:hidden;
  z-index:9999;
}

/* HEADER (k√©o panel) */
#infoHeader{
  height:40px;
  background:#242526;
  border-bottom:1px solid #3a3b3d;

  display:flex;
  align-items:center;
  justify-content:space-between;

  padding:0 12px;
  cursor:move;
  user-select:none;
}

#infoHeader span{
  font-size:13px;
  color:var(--sub);
}

#infoHeader button{
  background:none;
  border:none;
  color:var(--sub);
  font-size:14px;
  cursor:pointer;
}

#infoHeader button:hover{
  color:var(--fg);
}

/* BODY */
#infoBody{
  flex:1;
  padding:12px;
  overflow:auto;
}

#infoBody img{
  width:100%;
  height:auto;
  border-radius:10px;
  display:block;
}

.rainbow{
  background: linear-gradient(
    90deg,
    #ff5f6d,
    #ffc371,
    #47cf73,
    #38f9d7,
    #4facfe,
    #a18cd1,
    #f857a6
  );
  background-size: 300% 300%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rainbowMove 4s ease infinite;
}

@keyframes rainbowMove{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

#customPanel{
  position:fixed;
  top:120px;
  right:40px;
  width:300px;

  background:#2a2b2d;
  border:2px solid #3a3b3d;
  border-radius:16px;

  display:none;
  flex-direction:column;
  z-index:9999;
}

#customHeader{
  height:40px;
  background:#242526;
  border-bottom:1px solid #3a3b3d;

  display:flex;
  align-items:center;
  justify-content:space-between;

  padding:0 12px;
  cursor:move;
  user-select:none;
}

#customHeader span{
  font-size:13px;
  color:var(--sub);
}

#customHeader button{
  background:none;
  border:none;
  color:var(--sub);
  cursor:pointer;
}

#customHeader button:hover{
  color:var(--fg);
}

#customBody{
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

#customBody label{
  font-size:13px;
  color:var(--sub);
}

#customInput{
  padding:8px 10px;
  font-size:16px;
  background:#242526;
  border:2px solid #3a3b3d;
  border-radius:10px;
  color:var(--fg);
  outline:none;
}

#customInput:focus{
  border-color:var(--accent);
}

#customSubmit{
  margin-top:6px;
  padding:8px;
  background:#3a3b3d;
  border:none;
  border-radius:10px;
  color:var(--fg);
  cursor:pointer;
}

#customSubmit:hover{
  background:#4a4b4d;
}

@keyframes shake {
  0% { transform: translateX(0); }
  20% { transform: translateX(-6px); }
  40% { transform: translateX(6px); }
  60% { transform: translateX(-6px); }
  80% { transform: translateX(6px); }
  100% { transform: translateX(0); }
}

.practice-shake {
  animation: shake 0.25s;
}

</style>
</head>

<body>
<div id="app">

<div id="header">
  <div id="logo"><span class="rainbow">mt</span> morseType</div>

  <div id="header-actions">
    <span class="hicon" title="Achievements">‚òÖ</span>
    <span class="hicon" id="btn-info" title="">‚Ñπ</span>
    <span class="hicon" id="btn-settings" title="">‚öô</span>
  </div>
</div>





<div id="modeBarWrap">
  <div id="modeBar">

    <!-- LEFT -->
    <div class="bar-section">
      <span class="bar-btn" id="toggle-realism">@ realism</span>
      <span class="bar-btn" id="toggle-numbers">$ numbers</span>
    </div>

    <div class="bar-divider"></div>

    <!-- CENTER -->
    <div class="bar-section">
          <span class="mode active" data-mode="decode">decode</span>
          <span class="mode" data-mode="encode">encode</span>
          <span class="mode" data-mode="practice">practice</span>
          <span class="mode" data-mode="translator">translator</span>
    </div>

    <div class="bar-divider"></div>

    <!-- RIGHT -->
    <div class="bar-section">
      <span class="time active" data-count="15">15c</span>
      <span class="time" data-count="30">30c</span>
      <span class="time" data-count="60">60c</span>
      <span class="bar-btn" id="btn-custom">custom</span>
    </div>

  </div>
</div>

<div id="game">
  <div id="morse"></div>
  <div id="text"></div>

  <input id="decodeInput" style="display:none"
placeholder="">

  <button id="decodeSubmit" style="display:none">submit</button>
  <button id="restartBtn" style="display:none">restart</button>

  <div id="result"></div>
</div>

</div>

<!-- INFO PANEL -->
<div id="infoPanel">
  <div id="infoHeader">
    <span>International Morse Code</span>
    <button id="infoClose">‚úï</button>
  </div>
  <div id="infoBody">
    <img src="internationalmorse.jpg" alt="Morse Chart">
  </div>
</div>

<!-- CUSTOM COUNT PANEL -->
<div id="customPanel">
  <div id="customHeader">
    <span>Custom character count</span>
    <button id="customClose">‚úï</button>
  </div>

  <div id="customBody">
    <label>Characters</label>
    <input id="customInput" type="number" min="1" max="999" />
    <button id="customSubmit">Apply</button>
  </div>
</div>

<script>
const MORSE = {
  A:".-", B:"-...", C:"-.-.", D:"-..", E:".", F:"..-.", G:"--.", H:"....",
  I:"..", J:".---", K:"-.-", L:".-..", M:"--", N:"-.", O:"---",
  P:".--.", Q:"--.-", R:".-.", S:"...", T:"-",
  U:"..-", V:"...-", W:".--", X:"-..-", Y:"-.--", Z:"--..",

  0:"-----",
  1:".----",
  2:"..---",
  3:"...--",
  4:"....-",
  5:".....",
  6:"-....",
  7:"--...",
  8:"---..",
  9:"----."
};



const REAL_WORDS = [
  "HELLO","WORLD","MORSE","CODE","LEARN",
  "SIGNAL","RADIO","TYPE","PRACTICE","SPEED",
  "ALPHA","BRAVO","CHARLIE","DELTA","ECHO"
];

const REVERSE = Object.fromEntries(
  Object.entries(MORSE).map(([k,v])=>[v,k])
);

const dotSound = new Audio(
  "dot.mp3"
);

const dashSound = new Audio(
  "dash.mp3"
);

dotSound.preload = "auto";
dashSound.preload = "auto";

dotSound.volume = 0.5;
dashSound.volume = 0.5;

let GAME={
  mode:"decode",
  text:"",
  startTime:0,

  index:0,          // ch·ªØ hi·ªán t·∫°i
  currentMorse:""   // morse ƒëang g√µ
};

let CHAR_COUNT = 15;

let SETTINGS = {
  realism: false,
  numbers: false
};

function startGame(){
 morse.textContent="";
 text.textContent="";
 result.style.display="none";

 decodeInput.style.display="none";
 decodeSubmit.style.display="none";
 restartBtn.style.display="none";

 if(GAME.mode==="decode"){
   GAME.text=randomText();
   morse.textContent=toMorse(GAME.text);
   decodeInput.value="";
   decodeInput.style.display="inline-block";
   decodeInput.focus(); // üëà TH√äM D√íNG N√ÄY
   GAME.startTime=Date.now();
 }


 if(GAME.mode==="encode"){
   GAME.text = randomText();
   GAME.index = 0;
   GAME.currentMorse = "";

   text.innerHTML = renderEncodeText();
  
 }
}

function randomText(){
  // REALISTIC MODE
  if (SETTINGS.realism) {
    let parts = [];

    while (parts.join(" ").length < CHAR_COUNT) {
      let w = REAL_WORDS[Math.floor(Math.random() * REAL_WORDS.length)];
      if (SETTINGS.numbers && Math.random() < 0.3) {
        w += Math.floor(Math.random() * 10);
      }
      parts.push(w);
    }

    return parts.join(" ").slice(0, CHAR_COUNT);
  }

  // NON-REALISTIC MODE
  let chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  if (SETTINGS.numbers) chars += "0123456789";

  return Array.from(
    { length: CHAR_COUNT },
    () => chars[Math.floor(Math.random() * chars.length)]
  ).join("");
}




function renderEncodeText(){
  return GAME.text.split("").map((c,i)=>{
    if(i < GAME.index) return `<span style="color:#7ad07a">${c}</span>`;
    if(i === GAME.index) return `<span class="rainbow">${c}</span>`;
    return `<span style="opacity:.4">${c}</span>`;
  }).join("");
}

function toMorse(str){
 return str.split("").map(c=>MORSE[c]||"").join(" ");
}

decodeInput.oninput=()=>{
 if(GAME.mode==="encode"){
   const v=decodeInput.value
    .toUpperCase()
    .replace(SETTINGS.numbers ? /[^A-Z0-9]/g : /[^A-Z]/g, "");


   morse.textContent=toMorse(v);
 }
};

decodeSubmit.onclick=()=>{
 let correct=0;
 [...GAME.text].forEach((c,i)=>{
   if(decodeInput.value.toUpperCase()[i]===c) correct++;
 });
 showResult(Math.round(correct/GAME.text.length*100)+"%");
};

restartBtn.onclick=startGame;

function showResult(acc){
 result.style.display="flex";
 result.innerHTML=`
 <div><div class="result-big">${GAME.text.length}</div>chars</div>
 <div><div class="result-big">${acc}</div>accuracy</div>
 `;
}

document.querySelectorAll(".mode").forEach(b=>{
  b.onclick=()=>{
    if (b.classList.contains("disabled")) return;

    destroyPractice(); // üëà üëà üëà KILL PRACTICE NGAY L·∫¨P T·ª®C

    document.querySelectorAll(".mode").forEach(x=>{
      x.classList.remove("active","rainbow");
    });

    b.classList.add("active","rainbow");
    GAME.mode = b.dataset.mode;
    startGame();
  };
});

startGame();

document.addEventListener("keydown", e => {
  if (e.key === ".") {
    const s = dotSound.cloneNode();
    s.volume = dotSound.volume;
    s.play();
  }

  if (e.key === "-") {
    const s = dashSound.cloneNode();
    s.volume = dashSound.volume;
    s.play();
  }
});

document.addEventListener("keydown", e=>{
  
  // Enter ƒë·ªÉ submit decode
  if (GAME.mode === "decode" && e.key === "Enter") {
    e.preventDefault();
    decodeSubmit.onclick();
    return;
  }


  // / ƒë·ªÉ focus decode
  if (GAME.mode === "decode" && e.key === "/") {
    e.preventDefault();
    decodeInput.focus();
    return;
  }

  // Ctrl + R restart
  if (e.ctrlKey && e.key.toLowerCase() === 'r') {
    e.preventDefault();
    startGame();
    return;
  }

// encode only
 if (GAME.mode !== "encode") return;

 if (e.key !== "." && e.key !== "-") return;

 e.preventDefault();

// ‚úÖ SKIP SPACE T·ª∞ ƒê·ªòNG
 while (GAME.text[GAME.index] === " ") {
  GAME.index++;
   GAME.currentMorse = "";
   morse.textContent = "";
   text.innerHTML = renderEncodeText();
 }

// n·∫øu ƒë√£ encode xong
 if (GAME.index >= GAME.text.length) {
   showResult("100%");
   return;
 }

 GAME.currentMorse += e.key;
 morse.textContent = GAME.currentMorse;

 const expected = MORSE[GAME.text[GAME.index]];

 if (!expected || !expected.startsWith(GAME.currentMorse)) {
   GAME.currentMorse = "";
   morse.textContent = "";
   return;
 }

 if (GAME.currentMorse === expected) {
   GAME.index++;
   GAME.currentMorse = "";
   morse.textContent = "";

   if (GAME.index >= GAME.text.length) {
     showResult("100%");
   } else {
     text.innerHTML = renderEncodeText();
   }
 }
});

document.getElementById("btn-settings").onclick = () => {
  alert("Settings ‚Äì theme, sound, difficulty (todo)");
};

const btnRealism = document.getElementById("toggle-realism");
const btnNumbers = document.getElementById("toggle-numbers");

btnRealism.onclick = () => {
  SETTINGS.realism = !SETTINGS.realism;
  btnRealism.classList.toggle("active", SETTINGS.realism);
  startGame();
};

btnNumbers.onclick = () => {
  SETTINGS.numbers = !SETTINGS.numbers;
  btnNumbers.classList.toggle("active", SETTINGS.numbers);
  startGame();
};

const customBtn = document.getElementById("btn-custom");
const customPanel = document.getElementById("customPanel");
const customClose = document.getElementById("customClose");
const customInput = document.getElementById("customInput");
const customSubmit = document.getElementById("customSubmit");

customBtn.onclick = () => {
  customInput.value = CHAR_COUNT;
  customPanel.style.display = "flex";
  customInput.focus();
};

customClose.onclick = () => {
  customPanel.style.display = "none";
};

customSubmit.onclick = () => {
  const v = parseInt(customInput.value, 10);
  if (!v || v <= 0) return;

  CHAR_COUNT = v;

  // b·ªè active c·ªßa 15c 30c 60c
  document.querySelectorAll(".time").forEach(x=>{
    x.classList.remove("active","rainbow");
  });

  customPanel.style.display = "none";
  startGame();
};

customInput.addEventListener("keydown", e=>{
  if (e.key === "Enter") {
    customSubmit.onclick();
  }
});

const infoBtn = document.getElementById("btn-info");
const infoPanel = document.getElementById("infoPanel");
const infoClose = document.getElementById("infoClose");

infoBtn.onclick = () => {
  infoPanel.style.display = "flex";
};

infoClose.onclick = () => {
  infoPanel.style.display = "none";
};

const infoHeader = document.getElementById("infoHeader");

let isDragging = false;
let offsetX = 0;
let offsetY = 0;

infoHeader.addEventListener("mousedown", e=>{
  isDragging = true;
  offsetX = e.clientX - infoPanel.offsetLeft;
  offsetY = e.clientY - infoPanel.offsetTop;
});

document.addEventListener("mousemove", e=>{
  if(!isDragging) return;

  infoPanel.style.left = e.clientX - offsetX + "px";
  infoPanel.style.top  = e.clientY - offsetY + "px";
  infoPanel.style.right = "auto";
});

document.addEventListener("mouseup", ()=>{
  isDragging = false;
});

document.querySelectorAll(".time").forEach(t=>{
  t.onclick = () => {
    document.querySelectorAll(".time").forEach(x=>{
      x.classList.remove("active","rainbow");
    });

    t.classList.add("active","rainbow");
    CHAR_COUNT = +t.dataset.count;

    startGame();
  };
});

</script>

<script>
/* =========================
   PRACTICE MODE PACKAGE
   ========================= */

const PRACTICE = {
  active: false,
  targetChar: "",
  targetMorse: "",
  input: "",
  streak: 0,
  timer: null,
  timeLimit: 2000 // 2 gi√¢y
};

/* UI ELEMENTS */
const practiceStartBtn = document.createElement("button");
practiceStartBtn.textContent = "start";
practiceStartBtn.style.marginTop = "16px";
practiceStartBtn.style.padding = "8px 18px";
practiceStartBtn.style.borderRadius = "12px";
practiceStartBtn.style.border = "none";
practiceStartBtn.style.cursor = "pointer";
practiceStartBtn.style.background = "#3a3b3d";
practiceStartBtn.style.color = "var(--fg)";
practiceStartBtn.style.display = "none";

const practiceStreakEl = document.createElement("div");
practiceStreakEl.style.marginTop = "14px";
practiceStreakEl.style.color = "var(--sub)";
practiceStreakEl.textContent = "streak: 0";

document.getElementById("game").appendChild(practiceStartBtn);
document.getElementById("game").appendChild(practiceStreakEl);

/* LOGIC */
function practiceRandomChar(){
  const chars = SETTINGS.numbers
    ? "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"
    : "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  return chars[Math.floor(Math.random() * chars.length)];
}

function practiceNext(){
  if (GAME.mode !== "practice") return;
  clearTimeout(PRACTICE.timer);

  PRACTICE.input = "";
  PRACTICE.targetChar = practiceRandomChar();
  PRACTICE.targetMorse = MORSE[PRACTICE.targetChar];

  text.innerHTML = `<span class="rainbow">${PRACTICE.targetChar}</span>`;
  morse.innerHTML = renderPracticeMorse();

  PRACTICE.timer = setTimeout(() => {
    practiceFail();
  }, PRACTICE.timeLimit);
}

function practiceSuccess(){
  if (GAME.mode !== "practice") return;
  PRACTICE.streak++;
  practiceStreakEl.textContent = `streak: ${PRACTICE.streak}`;
  practiceNext();
}

function practiceFail(){
  if (GAME.mode !== "practice") return;

  const gameEl = document.getElementById("game");
  gameEl.classList.add("practice-shake");

  setTimeout(() => {
    gameEl.classList.remove("practice-shake");
  }, 250);

  PRACTICE.streak = 0;
  practiceStreakEl.textContent = `streak: 0`;
  practiceNext();
}

/* START BUTTON */
practiceStartBtn.onclick = () => {
  PRACTICE.active = true;
  PRACTICE.streak = 0;
  practiceStreakEl.textContent = "streak: 0";
  practiceNext();
};

/* KEY INPUT */
document.addEventListener("keydown", e => {
  if (!PRACTICE.active) return;
  if (GAME.mode !== "practice") return;
  if (e.key !== "." && e.key !== "-") return;

  e.preventDefault();
  PRACTICE.input += e.key;
  morse.innerHTML = renderPracticeMorse();

  if (!PRACTICE.targetMorse.startsWith(PRACTICE.input)) {
    practiceFail();
    return;
  }

  if (PRACTICE.input === PRACTICE.targetMorse) {
    practiceSuccess();
  }
});

/* HOOK V√ÄO startGame() */
const __startGame = startGame;
startGame = function(){
  __startGame();

  if (GAME.mode === "practice") {
    PRACTICE.active = false;
    morse.textContent = "";
    text.textContent = "press start";
    practiceStartBtn.style.display = "inline-block";
    practiceStreakEl.style.display = "block";
  } else {
    PRACTICE.active = false;
    practiceStartBtn.style.display = "none";
    practiceStreakEl.style.display = "none";
  }
};

function destroyPractice(){
  PRACTICE.active = false;

  if (PRACTICE.timer) {
    clearTimeout(PRACTICE.timer);
    PRACTICE.timer = null;
  }

  PRACTICE.input = "";
  PRACTICE.targetChar = "";
  PRACTICE.targetMorse = "";

  practiceStartBtn.style.display = "none";
  practiceStreakEl.style.display = "none";
}

function renderPracticeMorse(){
  return PRACTICE.targetMorse
    .split("")
    .map((c, i) => {
      if (i < PRACTICE.input.length) {
        return `<span style="color:#7ad07a">${c}</span>`;
      }
      return `<span style="opacity:.5">${c}</span>`;
    })
    .join("");
}

</script>

</body>
</html>



