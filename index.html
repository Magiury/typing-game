<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Morse Typing Game</title>
<style>
  body {
    font-family: monospace;
    background: #0f1220;
    color: #fff;
    padding: 20px;
  }
  button {
    margin: 5px;
    padding: 6px 12px;
    cursor: pointer;
  }
  input {
    padding: 6px;
    width: 300px;
    font-family: monospace;
  }
  .box {
    border: 1px solid #444;
    padding: 15px;
    margin-top: 15px;
  }
  .big {
    font-size: 24px;
    margin: 10px 0;
  }
</style>
</head>
<body>

<h1>ðŸŽ§ Morse Typing Game</h1>

<button onclick="setMode('decode')">Decode</button>
<button onclick="setMode('practice')">Practice</button>
<button onclick="setMode('free')">Free Mode</button>

<div id="game" class="box"></div>

<script>
const MORSE = {
  A: ".-", B: "-...", C: "-.-.", D: "-..", E: ".", F: "..-.",
  G: "--.", H: "....", I: "..", J: ".---", K: "-.-", L: ".-..",
  M: "--", N: "-.", O: "---", P: ".--.", Q: "--.-", R: ".-.",
  S: "...", T: "-", U: "..-", V: "...-", W: ".--", X: "-..-",
  Y: "-.--", Z: "--.."
};

const REVERSE = Object.fromEntries(
  Object.entries(MORSE).map(([k,v]) => [v,k])
);

const WORDS = ["HELLO", "MORSE", "CODE", "TYPE", "SIGNAL"];

let currentWord = "";
let practiceIndex = 0;
let userInput = "";

function randomWord() {
  return WORDS[Math.floor(Math.random()*WORDS.length)];
}

function setMode(mode) {
  if (mode === "decode") loadDecode();
  if (mode === "practice") loadPractice();
  if (mode === "free") loadFree();
}

/* ===================== DECODE ===================== */
function loadDecode() {
  currentWord = randomWord();
  userInput = "";

  const morse = currentWord.split("")
    .map(c => MORSE[c])
    .join(" / ");

  game.innerHTML = `
    <h2>Decode Mode</h2>
    <div class="big">${morse}</div>
    <input id="decodeInput" placeholder="Nháº­p chá»¯..." />
    <br>
    <button onclick="submitDecode()">Submit</button>
    <button onclick="loadDecode()">Restart</button>
    <div id="result"></div>
  `;
}

function submitDecode() {
  const input = document.getElementById("decodeInput").value.toUpperCase();
  let correct = 0;

  for (let i=0;i<currentWord.length;i++) {
    if (input[i] === currentWord[i]) correct++;
  }

  const acc = Math.round(correct / currentWord.length * 100);
  document.getElementById("result").innerHTML =
    `Accuracy: <b>${acc}%</b> (${correct}/${currentWord.length})`;
}

/* ===================== PRACTICE ===================== */
function loadPractice() {
  currentWord = randomWord();
  practiceIndex = 0;
  renderPractice();
}

function renderPractice() {
  const char = currentWord[practiceIndex];
  game.innerHTML = `
    <h2>Practice Mode</h2>
    <div class="big">Chá»¯: ${char}</div>
    <div>Morse: <b>${MORSE[char]}</b></div>
    <input id="practiceInput" placeholder="Nháº­p morse..." />
    <br>
    <button onclick="checkPractice()">Check</button>
    <div>${practiceIndex+1}/${currentWord.length}</div>
  `;
}

function checkPractice() {
  const input = document.getElementById("practiceInput").value.trim();
  if (input === MORSE[currentWord[practiceIndex]]) {
    practiceIndex++;
    if (practiceIndex >= currentWord.length) {
      game.innerHTML = `<h2>ðŸŽ‰ HoÃ n thÃ nh!</h2>
        <button onclick="loadPractice()">Word khÃ¡c</button>`;
    } else {
      renderPractice();
    }
  } else {
    alert("Sai rá»“i, thá»­ láº¡i!");
  }
}

/* ===================== FREE ===================== */
function loadFree() {
  game.innerHTML = `
    <h2>Free Mode</h2>
    <p>GÃµ chá»¯ â†’ morse hoáº·c morse â†’ chá»¯</p>
    <input id="freeInput" placeholder="VD: SOS hoáº·c ... --- ..." />
    <button onclick="convertFree()">Convert</button>
    <div id="freeResult" class="big"></div>
  `;
}

function convertFree() {
  const text = document.getElementById("freeInput").value.trim();

  if (text.includes(".") || text.includes("-")) {
    // morse â†’ chá»¯
    const letters = text.split(" ");
    let out = "";
    for (let m of letters) {
      out += REVERSE[m] || "?";
    }
    freeResult.innerText = out;
  } else {
    // chá»¯ â†’ morse
    freeResult.innerText = text.toUpperCase()
      .split("")
      .map(c => MORSE[c] || "?")
      .join(" ");
  }
}
</script>
</body>
</html>
