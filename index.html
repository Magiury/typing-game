<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Morse Duel</title>
<style>
body {
  background:#0e0e0e;
  color:#e5e5e5;
  font-family:monospace;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
#app { width:600px; }
h1 { text-align:center; letter-spacing:4px; }
#status { text-align:center; opacity:.6; margin:10px; }
#score { text-align:center; margin-bottom:10px; }
input {
  width:100%;
  background:transparent;
  border:none;
  border-bottom:1px solid #555;
  color:white;
  font-size:20px;
  outline:none;
}
</style>
</head>
<body>
<div id="app">
<h1>M O R S E &nbsp; D U E L</h1>
<div id="status">Connecting...</div>
<div id="score">You 0 — 0 Opponent</div>
<div id="game"></div>
</div>

<script>
const ws = new WebSocket("WSS_URL_HERE"); // ← SẼ ĐỔI SAU

let me = 0;
let sender = false;

const status = document.getElementById("status");
const score = document.getElementById("score");
const game = document.getElementById("game");

ws.onopen = () => ws.send(JSON.stringify({ type:"join" }));

ws.onmessage = e => {
  const d = JSON.parse(e.data);

  if (d.type === "waiting") status.textContent = "Waiting for player...";
  if (d.type === "start") {
    me = d.you;
    updateScore(d.scores);
    setRole(d.sender);
  }
  if (d.type === "playMorse") showDecode();
  if (d.type === "roundEnd") {
    updateScore(d.scores);
    setRole(d.sender);
  }
  if (d.type === "gameOver") status.textContent = "GAME OVER";
};

function setRole(s) {
  sender = s === me;
  game.innerHTML = "";
  status.textContent = sender ? "Send Morse" : "Decode Morse";
  if (sender) showSend();
}

function showSend() {
  const i = document.createElement("input");
  i.placeholder = "Press SPACE, Enter to send";
  let morse = "";
  i.onkeydown = e => {
    if (e.code === "Space") { morse += " "; e.preventDefault(); }
    if (e.key === "Enter") {
      ws.send(JSON.stringify({
        type:"morse",
        morse,
        text:"HELLO"
      }));
      morse = "";
      i.value = "";
    }
  };
  game.appendChild(i);
}

function showDecode() {
  game.innerHTML = `<input id="g" placeholder="Type decoded text"/>`;
  document.getElementById("g").onkeydown = e => {
    if (e.key === "Enter") {
      ws.send(JSON.stringify({
        type:"guess",
        text:e.target.value.toUpperCase(),
        player:me
      }));
    }
  };
}

function updateScore(s) {
  score.textContent = `You ${s[me]} — ${s[1-me]} Opponent`;
}
</script>
</body>
</html>
