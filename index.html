<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MorseType</title>
<style>
body {
  background:#111;
  color:#eee;
  font-family: monospace;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
#app { width:700px }
h1 { text-align:center; letter-spacing:4px }
#top { display:flex; justify-content:space-between; margin-bottom:10px }
select,button {
  background:#222;
  color:#eee;
  border:1px solid #333;
  padding:5px;
}
#text {
  font-size:24px;
  line-height:1.6;
  margin:20px 0;
}
.correct { color:#4caf50 }
.wrong { color:#f44336 }
.caret {
  display:inline-block;
  width:2px;
  height:1.2em;
  background:#eee;
  animation: blink 1s infinite;
}
@keyframes blink {
  0%,50%{opacity:1}
  51%,100%{opacity:0}
}
#status { text-align:center; opacity:.7 }
#timer { text-align:right }
#morse { font-size:28px; text-align:center; letter-spacing:6px }
</style>
</head>

<body>
<div id="app">
  <h1>MORSETYPE</h1>

  <div id="top">
    <select id="mode">
      <option value="decode">Decode</option>
      <option value="encode">Encode</option>
    </select>

    <select id="timeSelect">
      <option value="15">15s</option>
      <option value="30">30s</option>
      <option value="60" selected>60s</option>
    </select>

    <button onclick="start()">Start</button>
  </div>

  <div id="timer"></div>
  <div id="morse"></div>

  <div id="text"></div>
  <div id="status">Press Start</div>
</div>

<script>
const MORSE = {
  A:".-",B:"-...",C:"-.-.",D:"-..",E:".",F:"..-.",G:"--.",H:"....",
  I:"..",J:".---",K:"-.-",L:".-..",M:"--",N:"-.",O:"---",
  P:".--.",Q:"--.-",R:".-.",S:"...",T:"-",
  U:"..-",V:"...-",W:".--",X:"-..-",Y:"-.--",Z:"--..",
  0:"-----",1:".----",2:"..---",3:"...--",4:"....-",5:".....",
  6:"-....",7:"--...",8:"---..",9:"----.",
  " ":"/"
};

const REVERSE = Object.fromEntries(Object.entries(MORSE).map(a=>a.reverse()));

let text="", index=0, timer, timeLeft, mode;

const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
function beep(d){
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.frequency.value=600; g.gain.value=.1;
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+d);
}

function playMorse(str){
  let t=0;
  for(let c of str){
    if(c==="."){ setTimeout(()=>beep(.1),t); t+=200 }
    else if(c==="-"){ setTimeout(()=>beep(.3),t); t+=400 }
    else t+=600;
  }
}

function genText(){
  const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  let s="";
  for(let i=0;i<20;i++){
    s+=Math.random()<.15?" ":chars[Math.floor(Math.random()*chars.length)];
  }
  return s.trim();
}

function render(){
  const el=document.getElementById("text");
  el.innerHTML="";
  [...text].forEach((c,i)=>{
    const span=document.createElement("span");
    span.textContent=c;
    if(i<index) span.className="correct";
    if(i===index){
      span.appendChild(document.createElement("span")).className="caret";
    }
    el.appendChild(span);
  });
}

function start(){
  mode=document.getElementById("mode").value;
  text=genText();
  index=0;
  render();

  document.getElementById("morse").textContent="";
  if(mode==="decode"){
    const m=[...text].map(c=>MORSE[c]).join(" ");
    document.getElementById("morse").textContent=m;
    playMorse(m.replace(/ /g,""));
  }

  timeLeft=+document.getElementById("timeSelect").value;
  document.getElementById("timer").textContent=`${timeLeft}s`;

  clearInterval(timer);
  timer=setInterval(()=>{
    timeLeft--;
    document.getElementById("timer").textContent=`${timeLeft}s`;
    if(timeLeft<=0) end();
  },1000);
}

function end(){
  clearInterval(timer);
  document.getElementById("status").textContent="Finished";
}

document.addEventListener("keydown",e=>{
  if(!text) return;

  if(mode==="decode"){
    if(e.key.toUpperCase()===text[index]){
      index++; render();
      if(index>=text.length) end();
    }
  }else{
    if(e.key===" "){
      beep(.1);
    }
  }
});
</script>
</body>
</html>
